<!doctype html>
<html>

<body>
    <canvas id="can" width="400" height="400" style="background:Black"></canvas>
    <script>
        const KEY_LEFT = 37,
              KEY_UP = 38,
              KEY_RIGHT = 39,
              KEY_DONW = 40;

        let snakes = [42, 41],
            foodPos = 43,
            direction = 1,
            ctx = document.getElementById("can").getContext("2d");

        function draw(t, c) {
            ctx.fillStyle = c;
            let x = t % 20 * 20 + 1,
                y =  ~~(t / 20) * 20 + 1;
            ctx.fillRect(x,y, 18, 18);
        }

        document.onkeydown = function (e) {            
            let newDerection = -1;

            switch(e.keyCode){
                case KEY_LEFT:
                    newDerection = -1;
                    break;
                case KEY_UP:
                    newDerection = -20;
                    break;
                case KEY_RIGHT:
                    newDerection = 1;
                    break;
                case KEY_DONW:
                    newDerection = 20;
                    break;
                default:
                    return;               
            }

            if(newDerection == -direction)return;
            direction = newDerection;
        };

        function isHitTheWall(head){
            return snakes.indexOf(head, 1) > 0 || head < 0 || head > 399 || direction == 1 && head % 20 == 0 || direction == -1 && head % 20 == 19;
        }

        function caculateNextPos(pos,direction){
            return pos + direction;
        }

        function moveSnake(direction){
            let head = snakes[0];
            let newHead = caculateNextPos(head,direction);
            snakes.unshift(newHead);
            return newHead;
        }

        function isInSnake(pos){
            return snakes.indexOf(pos) > 0;
        }

        function getRandomFoodPos(){
            while(true){
                let randPos =  Math.random() * 400;
                randPos = Math.floor(randPos);

                if(! isInSnake(randPos)){
                    return randPos;
                }
            };
        }

        function process() {
            let newHead = moveSnake(direction);

            if (isHitTheWall(newHead)){
                return alert("GAME OVER");
            } 

            draw(newHead, "Green");

            if (newHead == foodPos) {
                foodPos = getRandomFoodPos();
                draw(foodPos, "Yellow");
            } else{
                draw(snakes.pop(), "Black");
            }

           
        }
        setInterval(process, 130);
    </script>
</body>

</html>