<!doctype html>
<html>

<body>
    <canvas id="can" width="400" height="400" style="background:Black"></canvas>
    <script>
        const KEY_LEFT = 37,
              KEY_UP = 38,
              KEY_RIGHT = 39,
              KEY_DONW = 40;

        let snakes = [42, 41],
            foodPos = 43,
            derection = 1,
            direction = KEY_LEFT,
            ctx = document.getElementById("can").getContext("2d");

        function draw(t, c) {
            ctx.fillStyle = c;
            let x = t % 20 * 20 + 1,
                y =  ~~(t / 20) * 20 + 1;
            ctx.fillRect(x,y, 18, 18);
        }

        document.onkeydown = function (e) {            
            let newDerection = -1;

            switch(e.keyCode){
                case KEY_LEFT:
                    newDerection = -1;
                    if(direction !=KEY_RIGHT)direction = KEY_LEFT;
                    break;
                case KEY_UP:
                    newDerection = -20;
                    if(direction !=KEY_DONW)direction = KEY_UP;
                    break;
                case KEY_RIGHT:
                    newDerection = 1;
                    if(direction !=KEY_LEFT)direction = KEY_RIGHT;
                    break;
                case KEY_DONW:
                    newDerection = 20;
                    if(direction !=KEY_UP)direction = KEY_DONW;
                    break;
                default:
                    return;               
            }

            if(newDerection == -derection)return;
            derection = newDerection;
        };

        function isHitTheWall(head){
            return snakes.indexOf(head, 1) > 0 || head < 0 || head > 399 || derection == 1 && head % 20 == 0 || derection == -1 && head % 20 == 19;
        }

        function caculateNextPos(pos,direction){
            return pos + direction;
        }

        function moveSnake(direction){
            let head = snakes[0];
            let newHead = caculateNextPos(head,direction);
            snakes.unshift(newHead);
            return newHead;
        }

        function process() {
            let newHead = moveSnake(derection);

            if (isHitTheWall(newHead)){
                return alert("GAME OVER");
            } 

            draw(newHead, "Green");

            if (newHead == foodPos) {
                while (snakes.indexOf(foodPos = ~~(Math.random() * 400)) >= 0);
                draw(foodPos, "Yellow");
            } else{
                draw(snakes.pop(), "Black");
            }

           
        }
        setInterval(process, 130);
    </script>
</body>

</html>