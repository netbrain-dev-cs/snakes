<!doctype html>

<html>

<body>

    <canvas id="can" width="400" height="400" style="background:Black"></canvas>

    <script>
        ;
        (function () {
            const WIDTH = 20;
            const MAX_WIDTH_INDEX = WIDTH - 1;
            const HEIGHT = 20;
            const POSITION_WIDTH = 20;
            const POSITION_HEIGHT = 20;
            const POSITIONS_LENGTH = WIDTH * HEIGHT;
            const MAX_POSITIONS_INDEX = POSITIONS_LENGTH - 1;

            const stepDic = {
                '37': -1, // left
                '38': -WIDTH, // top
                '39': 1, // right
                '40': WIDTH // down
            };

            var snake = [42, 41],
                food = 43,
                moveStep = 1,
                snakeHead,
                ctx = document.getElementById("can").getContext("2d");

            document.onkeydown = function (e) {
                var keyCode = (e || event).keyCode;
                updateMoveStep(keyCode);
            };

            move();

            return void(0);

            function updateMoveStep(keyCode) {
                var newStep = stepDic[keyCode];
                moveStep = newStep || moveStep;
            }

            function draw(positionIndex, c) {
                ctx.fillStyle = c;

                var x = positionIndex % WIDTH * POSITION_WIDTH + 1;
                var y = ~~(positionIndex / HEIGHT) * POSITION_HEIGHT + 1;

                ctx.fillRect(x, y, 18, 18);
            }

            function move() {
                snake.unshift(snakeHead = snake[0] + moveStep);

                if (isGameOver()) {
                    return alert("GAME OVER");
                }

                draw(snakeHead, "Lime");

                if (snakeHead == food) {
                    randomNewFood();
                    draw(food, "Yellow");
                } else {
                    draw(snake.pop(), "Black");
                }

                setTimeout(move, 130);
            }

            function randomNewFood() {
                while (snake.indexOf(food = ~~(Math.random() * POSITIONS_LENGTH)) >= 0);
            }

            function isGameOver() {
                return snake.indexOf(snakeHead, 1) > 0 ||
                    snakeHead < 0 ||
                    snakeHead > MAX_POSITIONS_INDEX ||
                    moveStep == 1 && snakeHead % WIDTH == 0 ||
                    moveStep == -1 && snakeHead % WIDTH == MAX_WIDTH_INDEX;
            }

        })();
    </script>

</body>

</html>